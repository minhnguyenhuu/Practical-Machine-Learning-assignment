# remove any existing lists and load required packages
rm(list=ls())
library(ggplot2)
library(lattice)
library(caret)
library(randomForest)

# Read data from Cloudfront into R
data_training=read.csv(file="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv",na.strings= c("NA",""," "))
data_testing=read.csv(file="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv",na.strings= c("NA",""," "))
dim(data_training)
dim(data_testing)

# Remove columns with NAs in the training set to reduce noise for the model.
data_training00 <- data_training[,colSums(is.na(data_training))==0]
data_testing00  <- data_testing[,colSums(is.na(data_testing))==0]

# Remover unique identifiers columns 1 to 7 in the training set.
data_training_prepared <- data_training00[,-c(1:7)]
data_testing_prepared <- data_testing00[,-c(1:7)]

# Split the training data into training and cross-validation partitions
inTrain <- createDataPartition(y=data_training_prepared$classe,p=0.7,list=FALSE)
training<-data_training_prepared[inTrain,]
validating<-data_training_prepared[-inTrain,]

# Fit a model using Random Forest and all other variables as predictors
modelFit<-randomForest(classe~.,  data=training)

#Cross-validation using validation set
pred<-predict(modelFit,validating)

# Determine model accuracy by using the confusion matrix
confusionMatrix(validating$classe,pred)

# Perform perdiction the a new data set containing 20 test cases
predTest<- predict(modelFit, data_testing_prepared)
predTest
